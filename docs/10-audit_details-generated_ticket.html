<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucy's Review - Audit Details - Equalify</title>
</head>
<body>
    <header>
        <nav aria-label="Main">
            <ul>
                <li><a href="#">Audits</a></li>
                <li><a href="11-pages-with_content.html">Pages</a></li>
                <li><a href="#">Logs</a></li>
                <li><a href="#">Account</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h1>Lucy's Review</h1>
        <article>
            <h2>Overview</h2>
            <p>2 checks on 2 pages. Runs monthly. Currently, idle.</p>
        </article>
        <article>
            <h2>Actions</h2>
            <nav aria-label="Audit Actions">
                <button>Run Audit</button>
                <a href="#">Edit Audit</a>    
            </nav>
        </article>
        <article>
            <h2>Progress</h2>
            <table>
                <thead>
                    <tr>
                        <th>Audit Snapshot</th>
                        <th>Fixed Blockers</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>11-1-24</td>
                        <td>0%</td>
                    </tr>
                </tbody>
            </table>
        </article>
        <article>
            <h2>Blockers</h2>
            <input type="checkbox" name="toggle" id="toggle_view_options"  />
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const viewOptions = document.getElementById("view_options");
                    const toggleViewOptions = document.getElementById("toggle_view_options");

                    // Hide view options by default
                    viewOptions.style.display = "none";
                    viewOptions.setAttribute("aria-hidden", "true");

                    // Toggle visibility on checkbox change
                    toggleViewOptions.addEventListener("change", function () {
                        if (toggleViewOptions.checked) {
                            viewOptions.style.display = "block";
                            viewOptions.setAttribute("aria-hidden", "false");
                        } else {
                            viewOptions.style.display = "none";
                            viewOptions.setAttribute("aria-hidden", "true");
                        }
                    });
                });
            </script>
            <label for="toggle_view_options">
                Show View Options
            </label>
            <section id="view_options">
                <h3>View Options</h3>
                <form>
                    <div role="group" aria-labelledby="search-group">
                        <h4 id="search-group">Search</h4>
                        <label for="search_source">Search In:</label>
                        <select id="search_source">
                            <option>Blocker Code</option>
                            <option>Page Title</option>
                            <option>URL</option>
                            <option>Tag</option>
                            <option>Issue</option>
                        </select>
                        <label for="search">Keywords:</label>
                        <input type="text" id="search">
                    </div>
                    
                    <div role="group" aria-labelledby="group-blockers">
                        <h4 id="group-blockers">Group Blockers By</h4>
                        <input id="group-issue" name="group" type="radio" checked>
                        <label for="group-issue">Issue</label>
                    
                        <input id="group-page" name="group" type="radio">
                        <label for="group-page">Page</label>
                    
                        <input id="group-check" name="group" type="radio">
                        <label for="group-check">Check</label>
                    
                        <input id="group-none" name="group" type="radio">
                        <label for="group-none">None</label>
                    </div>
                    
                    <div role="group" aria-labelledby="include-tags">
                        <h4 id="include-tags">Include Issues with Tag</h4>

                        <input id="tag-select-all" type="checkbox" checked>
                        <label for="tag-select-all">Select All</label>
                    
                        <input id="tag-wcag-a" name="tag" type="checkbox" checked>
                        <label for="tag-wcag-a">WCAG 2.2 A</label>
                    
                        <input id="tag-wcag-aa" name="tag" type="checkbox" checked>
                        <label for="tag-wcag-aa">WCAG 2.2 AA</label>
                    
                        <input id="tag-wcag-aaa" name="tag" type="checkbox" checked>
                        <label for="tag-wcag-aaa">WCAG 2.2 AAA</label>
                    
                        <input id="tag-heading-elements" name="tag" type="checkbox" checked>
                        <label for="tag-heading-elements">Heading Elements</label>

                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                const selectAllCheckbox = document.getElementById("tag-select-all");
                                const tagCheckboxes = document.querySelectorAll('div[aria-labelledby="include-tags"] input[type="checkbox"]:not(#tag-select-all)');
                        
                                selectAllCheckbox.addEventListener("change", function () {
                                    tagCheckboxes.forEach(checkbox => checkbox.checked = selectAllCheckbox.checked);
                                });
                        
                                // Update "Select All" state when any checkbox is manually changed
                                tagCheckboxes.forEach(checkbox => {
                                    checkbox.addEventListener("change", function () {
                                        selectAllCheckbox.checked = [...tagCheckboxes].every(cb => cb.checked);
                                    });
                                });
                            });
                        </script>
                    </div>
                    
                    <div role="group" aria-labelledby="include-status">
                        <h4 id="include-status">Include Blockers with Status</h4>
                        <input id="status-active" type="checkbox" checked>
                        <label for="status-active">Active</label>
                    
                        <input id="status-ignored" type="checkbox">
                        <label for="status-ignored">Ignored</label>
                    
                        <input id="status-equalified" type="checkbox" checked>
                        <label for="status-equalified">Equalified</label>
                    </div>
                    
                    <div role="group" aria-labelledby="sort-group">
                        <h4 id="sort-group">Sort</h4>
                        <input id="sort-az" name="sort" type="radio" checked>
                        <label for="sort-az">Alphabetically (A to Z)</label>
                    
                        <input id="sort-za" name="sort" type="radio">
                        <label for="sort-za">Alphabetically (Z to A)</label>
                    
                        <input id="sort-active-most" name="sort" type="radio">
                        <label for="sort-active-most">Active Blockers (Most to Least)</label>
                    
                        <input id="sort-active-least" name="sort" type="radio">
                        <label for="sort-active-least">Active Blockers (Least to Most)</label>
                    
                        <input id="sort-latest" name="sort" type="radio">
                        <label for="sort-latest">Audited (Latest to Oldest)</label>
                    
                        <input id="sort-oldest" name="sort" type="radio">
                        <label for="sort-oldest">Audited (Oldest to Latest)</label>
                    </div>
                    <button>Save View Options</button>
                </form>
            </section>
            <section>
                <h3>All Blockers - Grouped by Issue - Hiding Ignored Blockers</h3>
                <div class="accordion">
                    <h4>
                        <button id="issue-empty-alt-text" type="button" aria-expanded="false" class="accordion-trigger">
                            Empty Alt Text (2 Active Blockers) - Tags: WCAG 2.2 AA, Images
                        </button>
                    </h4>
                    <div role="region" aria-labelledby="issue-empty-alt-text" style="display: none;">
                        <a href="#">More info on "Empty Alt Text" Issue</a>
                        <input id="all-repeat-link-text" type="checkbox" class="select_all"> <label for="all-repeat-link-text">Select All Blockers with "Empty Alt Text" Issue</label>
                        <table summary="Includes all blockers related to the Empty Alt Text issue. Blocker code is in the first column, screenshot in the second, page title and url of the page with the blocker are in the third and fourth column, blocker status is in the fifth column, the check that caught the blocker is in the sixth column, and the audit date is in the seventh collumn. Each row represents a new blocker.">
                            <thead>
                                <tr>
                                    <th>Blocker Code</th>
                                    <th>Screenshot</th>
                                    <th>Page Title</th>
                                    <th>URL</th>
                                    <th>Status</th>
                                    <th>Check</th>
                                    <th>Audit Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th role="rowheader"><input id="blocker-3" type="checkbox"> <label for="blocker-3"><code>&lt;img class="weird_heading"&gt;</code></label></th>
                                    <td><img src="image.jpg" alt="Screenshot of Blocker 3"></td>
                                    <td>Berkeley Library (Staging)</td>
                                    <td><code>https://update.lib.berkeley.edu/</code></td>
                                    <td>Active</td>
                                    <td>empty-alt-text</td>
                                    <td>12-1-2024</td>
                                </tr>
                                <tr>
                                    <th role="rowheader"><input id="blocker-2" type="checkbox"> <label for="blocker-2"><code>&lt;img alt="" &gt;</code></th>
                                    <td><img src="image.jpg" alt="Screenshot of Blocker 1"></td>
                                    <td>Berkeley Homepage (Staging)</td>
                                    <td><code>https://www-stg.berkeley.edu</code></td>
                                    <td>Active</td>
                                    <td>empty-alt-text</td>
                                    <td>12-1-2024</td>
                                </tr>
                            </tbody>
                        </table>
                        <nav aria-label="Empty Alt Text Table of Blockers">
                            <label for="item-count">Showing 2 of 2 Blockers. Change Number of Blockers Displayed:</label> 
                            <select id="item-count">
                                <option selected>Up to 5</option>
                            </select>
                        </nav>
                    </div>
                </div>
                <script>
                // Accordion
                document.addEventListener("DOMContentLoaded", function () {
                    document.querySelectorAll(".accordion-trigger").forEach((button) => {
                        button.addEventListener("click", function () {
                            const panel = this.parentElement.nextElementSibling;
                            const isExpanded = this.getAttribute("aria-expanded") === "true";

                            // Toggle aria-expanded
                            this.setAttribute("aria-expanded", !isExpanded);

                            // Toggle visibility
                            if (!isExpanded) {
                                panel.style.display = "block";
                            } else {
                                panel.style.display = "none";
                            }
                        });
                    });
                });

                // Select All
                document.querySelectorAll('.select_all').forEach(selectAllCheckbox => {
                    selectAllCheckbox.addEventListener('change', function() {
                        const parent = this.closest('div, table, details');
                        const checkboxes = parent.querySelectorAll('input[type="checkbox"]:not(.select_all)');
                        checkboxes.forEach(checkbox => checkbox.checked = this.checked);
                    });
                });
                </script>
                <nav aria-label="Issues">
                    <label for="item-count">Showing 1 of 1 Issue Groups. Change Number of Issue Groups Displayed:</label> 
                    <select id="item-count">
                        <option selected>Up to 5</option>
                    </select>
                </nav>
            </section>    
            <section>
                <h3>Manage Selected Blockers</h3>
                <nav aria-label="Manage Selected Blockers">
                    <button>Ignore Blockers</button>
                    <button>Generate Ticket</button>
                    <!-- Accessible Modal -->
                    <div id="modal-dialog" role="dialog" aria-labelledby="modal-title" aria-modal="true">
                        <h4 id="modal-title">Generated Ticket</h4>
                        <div id="ticketStatus" aria-live="assertive">Ticket generated with two blockers from Lucy's Audit.</div>
                        
                        <form>                
                            <label for="ticket-content">Content:</label>
                            <textarea id="ticket-content">
                                ### Accessibility Issues Summary
                                
                                1. **Berkeley Library (Staging)** - [https://update.lib.berkeley.edu/](https://update.lib.berkeley.edu/)
                                - **Issue:** Heading tag without any text.
                                - **Code Snippet:** `<h1 class="weird_heading"></h1>`
                                - **Status:** Active.
                                - **Check Type:** `empty-headings`.
                                - **Audit Date:** 12-1-2024.
                                - **Suggested Fix:** Add meaningful text to the `<h1>` tag, e.g., `<h1>Welcome to the Library</h1>`.

                                2. **Berkeley Homepage (Staging)** - [https://www-stg.berkeley.edu](https://www-stg.berkeley.edu)
                                - **Issue:** Heading tag without any text.
                                - **Code Snippet:** `<h2><!-- Heading should not be empty --></h2>`
                                - **Status:** Active.
                                - **Check Type:** `empty-headings`.
                                - **Audit Date:** 12-1-2024.
                                - **Suggested Fix:** Include a descriptive heading, e.g., `<h2>Explore Berkeley's Resources</h2>`.

                                Ensure all headings are meaningful and assistive technology-friendly.

                                Rescan page at https://equalify.app/audit1
                            </textarea>

                            <nav aria-label="Generated Ticket Options">
                                <button type="button" id="copyButton">Copy Ticket</button>
                                <button type="button" disabled>Save to Jira - Coming Soon</button>
                                <button type="button" disabled>Save to GitHub - Coming Soon</button>
                                <button type="button" id="closeModal">Close</button>
                            </nav>
                        </form>
                    </div>

                    <!-- JavaScript for Modal Behavior -->
                    <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        const modal = document.getElementById("modal-dialog");
                        const closeModalButton = document.getElementById("closeModal");
                        const copyButton = document.getElementById("copyButton");
                        const mainContent = document.querySelector("main");
                        const headerContent = document.querySelector("header");
                        const footerContent = document.querySelector("footer");

                        function openModal() {
                            modal.style.display = "block";
                            modal.setAttribute("aria-hidden", "false");

                            // Hide the rest of the page from screen readers
                            if (mainContent) mainContent.setAttribute("aria-hidden", "true");
                            if (headerContent) headerContent.setAttribute("aria-hidden", "true");
                            if (footerContent) footerContent.setAttribute("aria-hidden", "true");

                            closeModalButton.focus();
                        }

                        function closeModal() {
                            modal.style.display = "none";
                            modal.setAttribute("aria-hidden", "true");

                            // Restore visibility of the rest of the page
                            if (mainContent) mainContent.setAttribute("aria-hidden", "false");
                            if (headerContent) headerContent.setAttribute("aria-hidden", "false");
                            if (footerContent) footerContent.setAttribute("aria-hidden", "false");
                        }

                        // Open modal on page load
                        openModal();

                        // Close modal on button click
                        closeModalButton.addEventListener("click", closeModal);

                        // Copy ticket content to clipboard
                        copyButton.addEventListener("click", function () {
                            const ticketContent = document.getElementById("ticket-content");
                            ticketContent.select();
                            document.execCommand("copy");
                            document.getElementById("ticketStatus").textContent = "Ticket content copied.";
                        });

                        // Trap focus inside modal
                        modal.addEventListener("keydown", function (event) {
                            if (event.key === "Tab") {
                                const focusableElements = modal.querySelectorAll("button, textarea");
                                const firstElement = focusableElements[0];
                                const lastElement = focusableElements[focusableElements.length - 1];

                                if (event.shiftKey && document.activeElement === firstElement) {
                                    event.preventDefault();
                                    lastElement.focus();
                                } else if (!event.shiftKey && document.activeElement === lastElement) {
                                    event.preventDefault();
                                    firstElement.focus();
                                }
                            }
                        });

                        // Close modal on Escape key
                        document.addEventListener("keydown", function (event) {
                            if (event.key === "Escape") {
                                closeModal();
                            }
                        });
                    });
                    </script>
                </nav>
            </section>    
        </article>
        <article>
            <h2>Related Logs</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Summary</th>
                        <th>Trigger</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th role="rowheader"><a href="#">Log 5</a></th>
                        <td>Ticket generated with two blockers from Lucy's Audit.</td>
                        <td>User: Lucy</td>
                    </tr>
                    <tr>
                        <th role="rowheader"><a href="#">Log 4</a></th>
                        <td>One blocker ignored in Lucy's Audit.</td>
                        <td>User: Lucy</td>
                    </tr>
                    <tr>
                        <th role="rowheader"><a href="#">Log 3</a></th>
                        <td>Audit ran. Three blockers found.</td>
                        <td>Lucy's Review Audit</td>
                    </tr>
                    <tr>
                        <th role="rowheader"><a href="#">Log 2</a></th>
                        <td>Lucy's Review created with two pages and two checks.</td>
                        <td>User: Lucy</td>
                    </tr>
                </tbody>
            </table> 
            <nav aria-label="Logs Table">
                <label for="item-count">Showing 4 of 4 Logs. Change Number of Logs Displayed:</label> 
                <select id="item-count">
                    <option selected>Up to 5</option>
                </select>
            </nav>
        </article>
    </main>

    <footer>
        <section>
            <h2>Scan Quota</h2>
            <p>0 free scans remaining. <a href="#">Upgrade</a>.</p>
        </section>
        <section>
            <h2>Need help?</h2>
            <p>Email <a href="#">support@equalify.app</a>.</p>
        </section>
    </footer>
</body>
</html>
